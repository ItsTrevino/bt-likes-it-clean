<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>BT Likes It</title>
  <style>
    body {
      background-color: black;
      color: white;
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    #canvas {
      display: block;
      margin: 0 auto;
    }
    input {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>BT ðŸ’›</h1>
  <input type="text" id="firstname" placeholder="FÃ¶rnamn">
  <input type="text" id="lastname" placeholder="Efternamn (eller &-namn)">
  <br />
  <button onclick="generate()">Generera</button>
  <canvas id="canvas" width="1080" height="1350"></canvas>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    async function loadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = src;
      });
    }

    async function generate() {
      const firstName = document.getElementById('firstname').value.toUpperCase();
      const lastName = document.getElementById('lastname').value.toUpperCase();

      if (!firstName || !lastName) {
        alert("Skriv bÃ¥de fÃ¶r- och efternamn!");
        return;
      }

      try {
        // Ladda bakgrund
        const background = await loadImage('images/background.png');
        ctx.drawImage(background, 0, 0, canvas.width, canvas.height);

        const letterHeight = Math.min(180, (canvas.width - 60) / Math.max(firstName.length, lastName.length)); // MaxhÃ¶jd + 30px marginal pÃ¥ varje sida
        const spacing = 10; // Justerbart avstÃ¥nd mellan bokstÃ¤ver
        const topOffset = 115; // FrÃ¥n toppen
        const lineGap = letterHeight * 1.2;

        const renderName = async (name, yPosition) => {
          let x = (canvas.width - calculateNameWidth(name, letterHeight, spacing)) / 2;
          for (let char of name) {
            if (char === ' ') {
              x += spacing * 2;
              continue;
            }
            const src = `images/${char}.png`;
            const img = await loadImage(src);
            const scale = letterHeight / img.height;
            const letterWidth = img.width * scale;
            ctx.drawImage(img, x, yPosition, letterWidth, letterHeight);
            x += letterWidth + spacing;
          }
        };

        const calculateNameWidth = (name, height, spacing) => {
          let total = 0;
          for (let char of name) {
            if (char === ' ') {
              total += spacing * 2;
              continue;
            }
            const img = new Image();
            img.src = `images/${char}.png`;
            // Note: vi gissar pÃ¥ ett genomsnitt hÃ¤r, detta kan bytas mot en mer exakt metod vid behov
            total += (height * 0.7) + spacing;
          }
          return total;
        };

        await renderName(firstName, topOffset);
        await renderName(lastName, topOffset + lineGap);

        // Likes it
        const likesIt = await loadImage('images/likes-it.png');
        const liHeight = letterHeight;
        const liScale = liHeight / likesIt.height;
        const liWidth = likesIt.width * liScale;
        const liX = (canvas.width - liWidth) / 2;
        const liY = topOffset + 2 * lineGap;
        ctx.drawImage(likesIt, liX, liY, liWidth, liHeight);

      } catch (err) {
        console.error("Fel under bildgenerering:", err);
        alert("NÃ¥got gick fel â€“ se konsolen fÃ¶r detaljer.");
      }
    }
  </script>
</body>
</html>
