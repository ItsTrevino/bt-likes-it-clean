<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BT Likes it</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #000;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 2rem;
    }
    canvas {
      margin-top: 1rem;
      border: 1px solid #fff;
      background: #111;
    }
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    input, button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border-radius: 5px;
      border: none;
    }
    button {
      background-color: #ffc107;
      color: #000;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>BT Likes it – Testläge</h1>
  <div class="input-group">
    <input id="firstName" placeholder="Förnamn" value="Anna" />
    <input id="lastName" placeholder="Efternamn" value="Öberg" />
    <button id="generateBtn">Generera bild</button>
  </div>
  <canvas id="canvas" width="1200" height="630"></canvas>

  <script>
    const generateBtn = document.getElementById('generateBtn');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    const loadImage = (src) => {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = () => resolve(img);
        img.onerror = (e) => reject(e);
        img.src = src;
      });
    };

    const drawImageFromName = async (first, last) => {
      try {
        generateBtn.textContent = "Genererar...";
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const bg = await loadImage('images/background.png');
        ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

        const fullName = `${first} ${last}`.toUpperCase();
        console.log("Fullt namn:", fullName);

        const letters = fullName.split('');
        const startX = 60;
        const startY = 450;
        let x = startX;

        for (const char of letters) {
          if (char === ' ') {
            x += 40;
            continue;
          }

          const url = `images/${char}.png`;
          console.log("Försöker ladda:", url);
          const letterImg = await loadImage(url);
          ctx.drawImage(letterImg, x, startY, letterImg.width, letterImg.height);
          x += letterImg.width + 10;
        }

        generateBtn.textContent = "Generera bild";

      } catch (error) {
        console.error("Fel under bildgenerering:", error);
        alert("Något gick fel – se konsolen för detaljer.");
        generateBtn.textContent = "Generera bild";
      }
    };

    generateBtn.addEventListener('click', () => {
      const first = document.getElementById('firstName').value.trim();
      const last = document.getElementById('lastName').value.trim();
      if (!first || !last) {
        alert("Fyll i både för- och efternamn!");
        return;
      }
      drawImageFromName(first, last);
    });
  </script>
</body>
</html>
