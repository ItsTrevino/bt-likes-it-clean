<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="UTF-8" />
    <title>BT Likes It – Kampanjsidan</title>
    <style>
      body {
        margin: 0;
        background-color: black;
        color: white;
        font-family: sans-serif;
        text-align: center;
      }

      canvas {
        margin-top: 20px;
        border: 2px solid white;
      }

      .container {
        margin-top: 50px;
      }

      input {
        font-size: 1.2rem;
        padding: 8px;
        margin: 10px;
      }

      button {
        font-size: 1.2rem;
        padding: 10px 20px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>BT start</h1>
      <input type="text" id="firstName" placeholder="Förnamn" />
      <input type="text" id="lastName" placeholder="Efternamn" />
      <button onclick="generateImage()">Generera</button>
      <br />
      <canvas id="canvas" width="1000" height="1400"></canvas>
    </div>

    <script>
      async function generateImage() {
        const firstName = document.getElementById("firstName").value.toUpperCase();
        const lastName = document.getElementById("lastName").value.toUpperCase();
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        if (!firstName || !lastName) {
          alert("Skriv både för- och efternamn!");
          return;
        }

        try {
          const bg = await loadImage("images/background.png");
          ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

          const allLetters = (firstName.length > lastName.length) ? firstName : lastName;
          const margin = 30;
          const availableWidth = canvas.width - 2 * margin;

          const letterImages = {};
          for (let char of new Set((firstName + lastName))) {
            if (char !== " ") {
              letterImages[char] = await loadImage(`images/${char}.png`);
            }
          }
          const likesItImage = await loadImage("images/likes-it.png");

          function getWordWidth(word) {
            let total = 0;
            for (let char of word) {
              if (char === " ") continue;
              const img = letterImages[char];
              const aspect = img.width / img.height;
              total += aspect;
            }
            return total;
          }

          const longestWord = firstName.length > lastName.length ? firstName : lastName;
          const totalAspect = getWordWidth(longestWord);
          const targetHeight = (availableWidth / totalAspect); // ensures the total width = availableWidth
          const topStart = 200;
          const lineSpacing = targetHeight * 1.5;

          function drawWord(word, y) {
            let x = margin;
            for (let char of word) {
              if (char === " ") continue;
              const img = letterImages[char];
              const aspect = img.width / img.height;
              const w = targetHeight * aspect;
              ctx.drawImage(img, x, y, w, targetHeight);
              x += w;
            }
          }

          drawWord(firstName, topStart);
          drawWord(lastName, topStart + lineSpacing);
          ctx.drawImage(likesItImage, margin, topStart + lineSpacing * 2, availableWidth, targetHeight);
        } catch (error) {
          console.error("Fel under bildgenerering: ", error);
          alert("Något gick fel – se konsolen för detaljer.");
        }
      }

      function loadImage(src) {
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.onload = () => resolve(img);
          img.onerror = reject;
          img.src = src;
        });
      }
    </script>
  </body>
</html>
