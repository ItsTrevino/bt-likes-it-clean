<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="UTF-8" />
    <title>BT Likes It – Kampanjsidan</title>
    <style>
      body {
        margin: 0;
        background-color: black;
        color: white;
        font-family: sans-serif;
        text-align: center;
      }

      canvas {
        margin-top: 20px;
        border: 2px solid white;
      }

      .container {
        margin-top: 50px;
      }

      input {
        font-size: 1.2rem;
        padding: 8px;
        margin: 10px;
      }

      button {
        font-size: 1.2rem;
        padding: 10px 20px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>BT start</h1>
      <input type="text" id="firstName" placeholder="Förnamn" />
      <input type="text" id="lastName" placeholder="Efternamn" />
      <button onclick="generateImage()">Generera</button>
      <br />
      <canvas id="canvas" width="1000" height="1400"></canvas>
    </div>

    <script>
  async function generateImage() {
    const firstName = document.getElementById("firstName").value.toUpperCase();
    const lastName = document.getElementById("lastName").value.toUpperCase();
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    if (!firstName || !lastName) {
      alert("Skriv både för- och efternamn!");
      return;
    }

    try {
      const bg = await loadImage("images/background.png");
      ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

      const margin = 30;
      const spacing = 5; // extra spacing mellan bokstäver

      const allLetters = new Set((firstName + lastName).replace(/ /g, ''));
      const letterImages = {};

      for (let char of allLetters) {
        letterImages[char] = await loadImage(`images/${char}.png`);
      }

      const likesItImage = await loadImage("images/likes-it.png");

      function getWordWidth(word, targetHeight) {
        return Array.from(word).reduce((total, char, i) => {
          if (char === " ") return total;
          const img = letterImages[char];
          const aspect = img.width / img.height;
          const width = targetHeight * aspect;
          return total + width + (i < word.length - 1 ? spacing : 0);
        }, 0);
      }

      const longerName = firstName.length > lastName.length ? firstName : lastName;

      const longestAspectSum = Array.from(longerName).reduce((sum, char) => {
        const img = letterImages[char];
        return sum + (img.width / img.height);
      }, 0);
      const availableWidth = canvas.width - margin * 2;
      const targetLetterHeight = (availableWidth - spacing * (longerName.length - 1)) / longestAspectSum;

      const lineSpacing = targetLetterHeight * 1.2;
      const startY = 150; // justerat från 200 → 150

      function drawWordCentered(word, y) {
        const wordWidth = getWordWidth(word, targetLetterHeight);
        let x = (canvas.width - wordWidth) / 2;

        for (let i = 0; i < word.length; i++) {
          const char = word[i];
          if (char === " ") continue;
          const img = letterImages[char];
          const aspect = img.width / img.height;
          const w = targetLetterHeight * aspect;
          ctx.drawImage(img, x, y, w, targetLetterHeight);
          x += w + spacing;
        }
      }

      drawWordCentered(firstName, startY);
      drawWordCentered(lastName, startY + lineSpacing);

      const likesAspect = likesItImage.width / likesItImage.height;
      const likesWidth = targetLetterHeight * likesAspect;
      const likesX = (canvas.width - likesWidth) / 2;
      const likesY = startY + 2 * lineSpacing;

      ctx.drawImage(likesItImage, likesX, likesY, likesWidth, targetLetterHeight);
    } catch (error) {
      console.error("Fel under bildgenerering: ", error);
      alert("Något gick fel – se konsolen för detaljer.");
    }
  }

  function loadImage(src) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.onload = () => resolve(img);
      img.onerror = reject;
      img.src = src;
    });
  }
</script>

