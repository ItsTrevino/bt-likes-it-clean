<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BT Likes It</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 40px;
    }
    input {
      margin: 5px;
      padding: 10px;
      font-size: 1rem;
    }
    button {
      padding: 10px 20px;
      font-size: 1rem;
      margin-top: 10px;
    }
    #output {
      margin-top: 20px;
    }
    canvas {
      border: 1px solid #ccc;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>BT start</h1>
  <input type="text" id="firstName" placeholder="Förnamn" />
  <input type="text" id="lastName" placeholder="Efternamn" />
  <button id="generateButton">Generera</button>

  <div id="output">
    <canvas id="canvas" width="1080" height="1080"></canvas>
  </div>

  <script>
    const imageBasePath = "images/";

    document.getElementById("generateButton").addEventListener("click", async () => {
      const firstName = document.getElementById("firstName").value.trim().toUpperCase();
      const lastName = document.getElementById("lastName").value.trim().toUpperCase();

      if (!firstName || !lastName) {
        alert("Fyll i både förnamn och efternamn!");
        return;
      }

      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      const loadImage = (src) => {
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.onload = () => resolve(img);
          img.onerror = (err) => reject(err);
          img.src = src;
        });
      };

      try {
        const bg = await loadImage(imageBasePath + "background.png");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

        const spacing = 80;
        const charWidth = 70;
        const startYFirst = 350;
        const startYLast = 460;

        const drawName = async (text, y) => {
          const chars = [...text];
          const totalWidth = chars.length * spacing;
          const startX = (canvas.width - totalWidth) / 2;

          for (let i = 0; i < chars.length; i++) {
            const char = convertSwedishChar(chars[i]);
            try {
              const charImg = await loadImage(`${imageBasePath}${char}.png`);
              ctx.drawImage(charImg, startX + i * spacing, y, charWidth, charWidth);
            } catch (e) {
              console.error("Kunde inte ladda bokstav:", char);
            }
          }
        };

        await drawName(firstName, startYFirst);
        await drawName(lastName, startYLast);

        // Lägg till "LIKES IT"
        ctx.fillStyle = "black";
        ctx.font = "bold 60px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText("LIKES IT", canvas.width / 2, 600);

      } catch (e) {
        console.error("Fel under bildgenerering:", e);
        alert("Något gick fel – se konsolen för detaljer.");
      }
    });

    function convertSwedishChar(char) {
      switch (char) {
        case "Å": return "Å";
        case "Ä": return "Ä";
        case "Ö": return "Ö";
        default: return char;
      }
    }
  </script>
</body>
</html>
