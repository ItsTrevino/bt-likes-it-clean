<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BT start</title>
  <style>
    body {
      background-color: black;
      color: white;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    canvas {
      margin-top: 20px;
      border: 2px solid white;
    }
    input {
      margin: 5px;
      padding: 8px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      border-radius: 6px;
      border: none;
      background-color: yellow;
      color: black;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>BT Likes it – Kampanjsidan är igång</h1>
  <input type="text" id="firstname" placeholder="Förnamn" />
  <input type="text" id="lastname" placeholder="Efternamn (eller &-namn)" />
  <button onclick="generate()">Generera</button>
  <canvas id="result" width="1200" height="630"></canvas>

  <script>
    async function generate() {
      const canvas = document.getElementById('result');
      const ctx = canvas.getContext('2d');
      const firstName = document.getElementById('firstname').value.toUpperCase().trim();
      const lastName = document.getElementById('lastname').value.toUpperCase().trim();

      if (!firstName || !lastName) {
        alert("Fyll i både för- och efternamn!");
        return;
      }

      // Ladda bakgrund
      const bg = new Image();
      bg.src = 'images/background.png';

      bg.onload = async () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

        const nameLines = [firstName, lastName];
        const charMap = {
          "&": "&.png"
        };

        // Hitta längsta raden
        const longestLine = nameLines.reduce((a, b) => a.length > b.length ? a : b);
        const spacing = 10; // mellan bokstäver
        const marginX = 30;
        const maxTextHeight = 180;

        // Beräkna bokstavsstorlek utifrån längsta raden + clamp till maxhöjd
        const tempImg = new Image();
        tempImg.src = 'images/A.png';
        await tempImg.decode();
        const aspectRatio = tempImg.width / tempImg.height;

        const availableWidth = canvas.width - marginX * 2 - spacing * (longestLine.length - 1);
        const letterWidth = availableWidth / longestLine.length;
        const letterHeightRaw = letterWidth / aspectRatio;
        const letterHeight = Math.min(letterHeightRaw, maxTextHeight);
        const finalLetterWidth = letterHeight * aspectRatio;

        const lineSpacing = letterHeight * 1.2;
        const startY = 115;

        for (let lineIndex = 0; lineIndex < nameLines.length; lineIndex++) {
          const name = nameLines[lineIndex];
          const totalWidth = name.length * finalLetterWidth + (name.length - 1) * spacing;
          const startX = (canvas.width - totalWidth) / 2;
          const y = startY + lineIndex * lineSpacing;

          for (let i = 0; i < name.length; i++) {
            const char = name[i];
            const fileName = charMap[char] || `${char}.png`;
            const img = new Image();
            img.src = `images/${fileName}`;
            await img.decode();
            ctx.drawImage(img, startX + i * (finalLetterWidth + spacing), y, finalLetterWidth, letterHeight);
          }
        }

        // Rita "likes-it.png" med samma höjd, och skalad bredd
        const likesImg = new Image();
        likesImg.src = 'images/likes-it.png';
        await likesImg.decode();

        const likesRatio = likesImg.width / likesImg.height;
        const likesWidth = letterHeight * likesRatio;
        const likesY = startY + 2 * lineSpacing;
        const likesX = (canvas.width - likesWidth) / 2;

        ctx.drawImage(likesImg, likesX, likesY, likesWidth, letterHeight);
      };

      bg.onerror = (err) => {
        console.error("Fel under bildgenerering: ", err);
        alert("Något gick fel – se konsolen för detaljer.");
      };
    }
  </script>
</body>
</html>
