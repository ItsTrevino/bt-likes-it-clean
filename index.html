<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BT Likes It</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 40px;
    }
    input {
      margin: 5px;
      padding: 10px;
      font-size: 1rem;
    }
    button {
      padding: 10px 20px;
      font-size: 1rem;
      margin-top: 10px;
    }
    canvas {
      margin-top: 20px;
      border: 1px solid #ccc;
      max-width: 100%;
    }
  </style>
</head>
<body>
  <h1>BT start</h1>
  <input type="text" id="firstName" placeholder="Förnamn" />
  <input type="text" id="lastName" placeholder="Efternamn" />
  <button id="generateButton">Generera</button>

  <canvas id="canvas" width="1080" height="1350"></canvas>

  <script>
    const imageBasePath = "images/";

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    document.getElementById("generateButton").addEventListener("click", async () => {
      const firstName = document.getElementById("firstName").value.trim().toUpperCase();
      const lastName = document.getElementById("lastName").value.trim().toUpperCase();

      if (!firstName || !lastName) {
        alert("Fyll i både förnamn och efternamn!");
        return;
      }

      try {
        // Ladda bakgrundsbild
        const bg = await loadImage(imageBasePath + "background.png");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

        // Rita förnamn och efternamn
        await drawName(firstName, 380);
        await drawName(lastName, 540);

        // Rita "LIKES IT" som bild
        const likesItImg = await loadImage(imageBasePath + "likes-it.png");
        const likesItWidth = 600;
        const likesItHeight = likesItImg.height * (likesItWidth / likesItImg.width);
        const likesItX = (canvas.width - likesItWidth) / 2;
        ctx.drawImage(likesItImg, likesItX, 700, likesItWidth, likesItHeight);

      } catch (e) {
        console.error("Fel under bildgenerering:", e);
        alert("Något gick fel – se konsolen för detaljer.");
      }
    });

    async function drawName(text, y) {
      const chars = [...text];
      const images = await Promise.all(chars.map(async (char) => {
        const filename = convertSwedishChar(char);
        return await loadImage(imageBasePath + filename + ".png");
      }));

      const totalOriginalWidth = images.reduce((sum, img) => sum + img.width, 0);
      const maxWidth = canvas.width - 60; // 30px marginal på varje sida
      const scale = Math.min(1, maxWidth / totalOriginalWidth);

      let x = (canvas.width - totalOriginalWidth * scale) / 2;

      for (let img of images) {
        const w = img.width * scale;
        const h = img.height * scale;
        ctx.drawImage(img, x, y, w, h);
        x += w;
      }
    }

    function loadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = src;
      });
    }

    function convertSwedishChar(char) {
      switch (char) {
        case "Å": return "Å";
        case "Ä": return "Ä";
        case "Ö": return "Ö";
        default: return char;
      }
    }
  </script>
</body>
</html>
