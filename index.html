<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BT Likes It</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
    }
    h1 {
      margin-top: 20px;
      font-size: 2rem;
    }
    form {
      margin-top: 20px;
    }
    input {
      padding: 10px;
      font-size: 1rem;
      border-radius: 5px;
      border: none;
    }
    button {
      padding: 10px 15px;
      font-size: 1rem;
      margin-left: 10px;
      border: none;
      border-radius: 5px;
      background-color: gold;
      cursor: pointer;
    }
    canvas {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <h1>BT – START</h1>
  <form id="nameForm">
    <input type="text" id="firstName" placeholder="Förnamn" required>
    <input type="text" id="lastName" placeholder="Efternamn" required>
    <button type="submit">Generera</button>
  </form>
  <canvas id="canvas" width="1080" height="1350"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    async function loadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = src;
      });
    }

    async function generateImage(firstName, lastName) {
      const name = (firstName + " " + lastName).toUpperCase();
      const images = {};
      const letters = [...new Set(name.replace(/[^A-ZÅÄÖ ]/gi, ""))];

      // Ladda bakgrund och "likes-it"
      images["background"] = await loadImage("/images/background.png");
      images["likes-it"] = await loadImage("/images/likes-it.png");

      for (const letter of letters) {
        const filename = letter === " " ? null : letter.toUpperCase();
        if (filename) {
          images[letter] = await loadImage(`/images/${filename}.png`);
        }
      }

      // Rita bakgrund
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(images["background"], 0, 0, canvas.width, canvas.height);

      // Rita namn (bokstav för bokstav)
      const top = 420;
      const lineHeight = 250;
      const startX = 60;
      const maxWidth = canvas.width - 2 * startX;
      const words = name.split(" ");

      words.forEach((word, lineIndex) => {
        const totalLetterWidth = maxWidth / word.length;
        [...word].forEach((char, i) => {
          const img = images[char];
          if (!img) return;

          const aspect = img.height / img.width;
          const width = totalLetterWidth;
          const height = width * aspect;
          const x = startX + i * totalLetterWidth;
          const y = top + lineIndex * lineHeight;

          ctx.drawImage(img, x, y, width, height);
        });
      });

      // Rita "LIKES IT" proportionellt under namnet
      const likesImg = images["likes-it"];
      const likesWidth = canvas.width * 0.6;
      const likesHeight = likesWidth * (likesImg.height / likesImg.width);
      const likesX = (canvas.width - likesWidth) / 2;
      const likesY = top + words.length * lineHeight + 50;

      ctx.drawImage(likesImg, likesX, likesY, likesWidth, likesHeight);
    }

    document.getElementById("nameForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const firstName = document.getElementById("firstName").value.trim();
      const lastName = document.getElementById("lastName").value.trim();
      if (firstName && lastName) {
        await generateImage(firstName, lastName);
      }
    });
  </script>
</body>
</html>
